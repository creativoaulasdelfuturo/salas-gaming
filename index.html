<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comunicaciones Salas Gaming - Gestión Local</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-purple: #bc13fe;
            --neon-pink: #ff00ea;
            --dark-bg: #0d0d15;
            --card-bg: #1a1a2e;
            --danger: #ef4444;
            --success: #22c55e;
        }

        body {
            background-color: var(--dark-bg);
            color: #e0e0e0;
            font-family: 'Rajdhani', sans-serif;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(188, 19, 254, 0.1) 0%, transparent 50%),
                linear-gradient(rgba(0, 242, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.05) 1px, transparent 1px);
            background-size: 100% 100%, 30px 30px, 30px 30px;
        }

        .font-gaming { font-family: 'Orbitron', sans-serif; }

        .neon-border {
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.3), inset 0 0 5px rgba(0, 242, 255, 0.2);
        }

        .neon-text {
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue);
        }

        .gaming-card {
            background: var(--card-bg);
            border-left: 4px solid var(--neon-purple);
            transition: all 0.3s ease;
        }

        .row-rejected {
            background: rgba(239, 68, 68, 0.2) !important;
            border-left-color: var(--danger) !important;
        }
        
        .row-won {
            background: rgba(34, 197, 94, 0.2) !important;
            border-left-color: var(--success) !important;
            box-shadow: inset 0 0 20px rgba(34, 197, 94, 0.15);
        }

        .phase-badge {
            padding: 6px 4px;
            border-radius: 4px;
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
            width: 100%;
            text-align: center;
            appearance: none;
            outline: none;
            transition: all 0.2s;
        }

        .status-espera { background: #374151; color: #d1d5db; }
        .status-aceptado { background: #2563eb; color: white; box-shadow: 0 0 8px #2563eb; }
        .status-rechazado { background: #dc2626; color: white; box-shadow: 0 0 8px #dc2626; }
        
        .status-final-win { 
            background: #16a34a !important; 
            box-shadow: 0 0 15px #16a34a !important; 
        }

        input, select, textarea {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid rgba(0, 242, 255, 0.3) !important;
            color: white !important;
        }

        option { background: #1a1a2e; color: white; }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: var(--dark-bg); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--neon-purple); border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <header class="max-w-7xl mx-auto mb-8 flex flex-col items-center">
        <div class="w-full flex justify-between items-end border-b-2 border-cyan-500 pb-4 mb-4">
            <div class="flex items-center gap-4">
                <div id="logo-container" class="w-20 h-20 bg-slate-900 rounded-lg flex items-center justify-center border-2 border-cyan-500 overflow-hidden relative group shadow-[0_0_15px_rgba(0,242,255,0.2)]">
                    <input type="file" id="logo-upload" class="absolute inset-0 opacity-0 cursor-pointer z-10" accept="image/*">
                    <img id="logo-preview" src="" class="w-full h-full object-cover hidden" alt="Logo Corporativo">
                    <div id="logo-placeholder" class="text-[10px] text-center p-1 text-gray-400 uppercase">Logo</div>
                    <div class="absolute inset-0 bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center pointer-events-none">
                        <span class="text-[8px] text-cyan-300 font-gaming">CAMBIAR</span>
                    </div>
                </div>
                <div>
                    <h1 class="text-3xl font-gaming neon-text tracking-tighter uppercase leading-none">Comunicaciones</h1>
                    <h2 class="text-xl font-gaming text-purple-400 tracking-tighter uppercase mb-1">Salas Gaming</h2>
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-cyan-500"></div>
                        <p class="text-xs text-cyan-400 uppercase tracking-[0.2em]">Modo: <span class="text-white">Almacenamiento Local</span></p>
                    </div>
                </div>
            </div>
            <div class="hidden md:block text-right">
                <p class="text-[10px] text-purple-400 font-mono uppercase" id="edit-indicator">Creando Nuevo Registro</p>
                <p id="clock" class="text-xl font-gaming text-white">00:00:00</p>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-6">
        <aside class="lg:col-span-1 space-y-6">
            <div class="neon-border p-4 bg-black bg-opacity-40 rounded-lg">
                <h2 class="font-gaming text-sm mb-4 text-purple-400 uppercase tracking-tighter" id="form-title">Añadir Objetivo</h2>
                <form id="client-form" class="space-y-3">
                    <input type="hidden" id="edit_id">
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">Contacto</label>
                        <input type="text" id="contact_name" required class="w-full p-2 rounded text-sm" placeholder="Nombre...">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">Empresa</label>
                        <input type="text" id="company_name" required class="w-full p-2 rounded text-sm" placeholder="Nombre Empresa...">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">Email Corporativo</label>
                        <input type="email" id="email" required class="w-full p-2 rounded text-sm" placeholder="mail@empresa.com">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">Teléfono</label>
                        <input type="tel" id="phone" required class="w-full p-2 rounded text-sm" placeholder="+34 ...">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">Contacto Inicial</label>
                        <input type="date" id="init_date" required class="w-full p-2 rounded text-sm">
                    </div>
                    <div class="pt-2 flex flex-col gap-2">
                        <button type="submit" id="submit-btn" class="w-full py-2 bg-cyan-600 hover:bg-cyan-500 text-white font-gaming text-xs transition-colors rounded uppercase shadow-lg">
                            Registrar en Memoria
                        </button>
                        <button type="button" id="cancel-edit" class="hidden w-full py-1 bg-gray-800 hover:bg-gray-700 text-gray-400 font-gaming text-[10px] transition-colors rounded uppercase">
                            Cancelar Edición
                        </button>
                    </div>
                </form>
            </div>
        </aside>

        <section class="lg:col-span-3">
            <div class="neon-border bg-black bg-opacity-60 rounded-lg overflow-hidden flex flex-col h-[700px]">
                <div class="p-4 bg-slate-900 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-cyan-900">
                    <h2 class="font-gaming text-sm tracking-widest text-cyan-300 uppercase">Panel de Control Local</h2>
                    
                    <div class="relative w-full md:w-1/3 group">
                        <input type="text" id="search-input" placeholder="FILTRAR LISTA..." 
                               class="w-full bg-black/50 border border-cyan-900 text-cyan-100 text-xs rounded px-3 py-1.5 focus:border-cyan-400 outline-none transition-colors uppercase pl-8">
                        <svg class="w-3 h-3 text-cyan-700 absolute left-2.5 top-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>

                    <div class="text-[10px] font-mono text-gray-400 uppercase">
                        Total Registros: <span id="count-total" class="text-cyan-400">0</span>
                    </div>
                </div>
                
                <div class="overflow-x-auto overflow-y-auto flex-grow custom-scrollbar">
                    <table class="w-full text-left text-sm min-w-[1100px]">
                        <thead class="bg-black text-[10px] text-gray-500 uppercase sticky top-0 z-10">
                            <tr>
                                <th class="p-4 border-b border-gray-800">Identidad</th>
                                <th class="p-4 border-b border-gray-800">Fecha</th>
                                <th class="p-4 border-b border-gray-800 text-center">Mail 1</th>
                                <th class="p-4 border-b border-gray-800 text-center">Interacción</th>
                                <th class="p-4 border-b border-gray-800 text-center">Formalización</th>
                                <th class="p-4 border-b border-gray-800 text-center">Cerrado</th>
                                <th class="p-4 border-b border-gray-800">Notas</th>
                                <th class="p-4 border-b border-gray-800 text-right">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="client-list">
                            <!-- Inyectado vía JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Notas -->
    <div id="note-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-[100] p-4">
        <div class="neon-border bg-[#1a1a2e] p-6 rounded-lg w-full max-w-md">
            <h3 class="font-gaming text-cyan-400 mb-4 uppercase text-sm">Actualizar Notas</h3>
            <textarea id="note-textarea" class="w-full h-32 p-3 rounded mb-4 text-sm" placeholder="Añade información relevante..."></textarea>
            <div class="flex gap-3">
                <button id="save-note-btn" class="flex-1 py-2 bg-green-600 text-white font-gaming text-[10px] uppercase rounded">Guardar</button>
                <button onclick="window.closeNoteModal()" class="flex-1 py-2 bg-gray-700 text-white font-gaming text-[10px] uppercase rounded">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-4 right-4 translate-y-20 transition-transform duration-300 bg-cyan-900 border border-cyan-400 p-3 rounded-lg shadow-2xl text-xs font-gaming z-50 uppercase">
        BASE DE DATOS ACTUALIZADA
    </div>

    <script>
        // --- GESTIÓN DE DATOS LOCALES ---
        let clientsData = JSON.parse(localStorage.getItem('gaming_crm_data')) || [];
        let currentEditingId = null;
        let searchTerm = "";

        // Guardar en LocalStorage
        const saveData = () => {
            localStorage.setItem('gaming_crm_data', JSON.stringify(clientsData));
            render();
            showToast("SISTEMA ACTUALIZADO");
        };

        const render = () => {
            const list = document.getElementById('client-list');
            const filtered = clientsData.filter(c => {
                const term = searchTerm.toLowerCase();
                return (c.contact_name?.toLowerCase().includes(term) || 
                        c.company_name?.toLowerCase().includes(term) || 
                        c.email?.toLowerCase().includes(term));
            });

            document.getElementById('count-total').innerText = clientsData.length;

            if (filtered.length === 0) {
                list.innerHTML = `<tr><td colspan="8" class="p-12 text-center text-gray-500 font-mono uppercase">SIN DATOS GUARDADOS</td></tr>`;
                return;
            }

            const sorted = [...filtered].sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0));

            list.innerHTML = sorted.map(c => {
                const values = { f1: c.f1 || 'espera', f2: c.f2 || 'espera', f3: c.f3 || 'espera', f4: c.f4 || 'espera' };
                const hasRejected = Object.values(values).includes('rechazado');
                const isWon = values.f4 === 'aceptado' && !hasRejected;

                let rowStyle = 'border-b border-gray-800 gaming-card hover:bg-white/5 transition-all';
                if (hasRejected) rowStyle += ' row-rejected';
                else if (isWon) rowStyle += ' row-won';

                return `
                <tr class="${rowStyle}">
                    <td class="p-4">
                        <div class="font-bold text-white uppercase text-xs">${c.contact_name}</div>
                        <div class="text-[10px] text-cyan-400 font-mono">${c.company_name}</div>
                        <div class="text-[9px] text-gray-500">${c.email}</div>
                    </td>
                    <td class="p-4 text-gray-400 font-mono text-[10px]">${c.init_date}</td>
                    
                    ${['f1', 'f2', 'f3', 'f4'].map(key => `
                        <td class="p-4 text-center">
                            <select onchange="window.updateStatus('${c.id}', '${key}', this.value)" class="phase-badge status-${values[key]} ${key==='f4' && values[key]==='aceptado' ? 'status-final-win' : ''}">
                                <option value="espera" ${values[key]==='espera'?'selected':''}>Espera</option>
                                <option value="aceptado" ${values[key]==='aceptado'?'selected':''}>Aceptado</option>
                                <option value="rechazado" ${values[key]==='rechazado'?'selected':''}>Rechazado</option>
                            </select>
                        </td>
                    `).join('')}

                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <div class="text-[10px] text-gray-400 italic max-w-[100px] truncate" title="${c.notes || ''}">
                                ${c.notes || '---'}
                            </div>
                            <button onclick="window.openNoteModal('${c.id}')" class="text-cyan-500 hover:text-white transition-colors">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path></svg>
                            </button>
                        </div>
                    </td>

                    <td class="p-4 text-right">
                        <div class="flex justify-end gap-2">
                            <button onclick="window.startEdit('${c.id}')" class="text-cyan-600 hover:text-cyan-400 p-2 transition-colors" title="Editar Campos">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            </button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        };

        // --- ACCIONES ---

        window.startEdit = (id) => {
            const client = clientsData.find(c => c.id === id);
            if (!client) return;

            document.getElementById('edit_id').value = client.id;
            document.getElementById('contact_name').value = client.contact_name;
            document.getElementById('company_name').value = client.company_name;
            document.getElementById('email').value = client.email;
            document.getElementById('phone').value = client.phone;
            document.getElementById('init_date').value = client.init_date;

            document.getElementById('form-title').innerText = "Editar Objetivo";
            document.getElementById('submit-btn').innerText = "Actualizar Registro";
            document.getElementById('edit-indicator').innerText = "Editando Registro Existente";
            document.getElementById('cancel-edit').classList.remove('hidden');
            
            document.getElementById('contact_name').focus();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        document.getElementById('cancel-edit').onclick = () => {
            resetForm();
        };

        const resetForm = () => {
            document.getElementById('client-form').reset();
            document.getElementById('edit_id').value = "";
            document.getElementById('form-title').innerText = "Añadir Objetivo";
            document.getElementById('submit-btn').innerText = "Registrar en Memoria";
            document.getElementById('edit-indicator').innerText = "Creando Nuevo Registro";
            document.getElementById('cancel-edit').classList.add('hidden');
        };

        document.getElementById('client-form').onsubmit = (e) => {
            e.preventDefault();
            const editId = document.getElementById('edit_id').value;

            if (editId) {
                const index = clientsData.findIndex(c => c.id === editId);
                if (index !== -1) {
                    clientsData[index] = {
                        ...clientsData[index],
                        contact_name: document.getElementById('contact_name').value,
                        company_name: document.getElementById('company_name').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value,
                        init_date: document.getElementById('init_date').value,
                    };
                }
            } else {
                const newClient = {
                    id: crypto.randomUUID(),
                    contact_name: document.getElementById('contact_name').value,
                    company_name: document.getElementById('company_name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    init_date: document.getElementById('init_date').value,
                    f1: 'espera', f2: 'espera', f3: 'espera', f4: 'espera',
                    notes: '',
                    timestamp: Date.now()
                };
                clientsData.push(newClient);
            }
            
            saveData();
            resetForm();
        };

        window.updateStatus = (id, key, val) => {
            const index = clientsData.findIndex(c => c.id === id);
            if (index !== -1) {
                clientsData[index][key] = val;
                saveData();
            }
        };

        window.openNoteModal = (id) => {
            currentEditingId = id;
            const client = clientsData.find(c => c.id === id);
            document.getElementById('note-textarea').value = client?.notes || "";
            document.getElementById('note-modal').style.display = 'flex';
        };

        window.closeNoteModal = () => {
            document.getElementById('note-modal').style.display = 'none';
        };

        document.getElementById('save-note-btn').onclick = () => {
            const index = clientsData.findIndex(c => c.id === currentEditingId);
            if (index !== -1) {
                clientsData[index].notes = document.getElementById('note-textarea').value;
                saveData();
                window.closeNoteModal();
            }
        };

        document.getElementById('search-input').oninput = (e) => {
            searchTerm = e.target.value;
            render();
        };

        function showToast(m) {
            const t = document.getElementById('toast');
            t.innerText = m;
            t.classList.remove('translate-y-20');
            setTimeout(() => t.classList.add('translate-y-20'), 2000);
        }

        setInterval(() => { 
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('es-ES'); 
        }, 1000);

        const storedLogo = localStorage.getItem('gaming_crm_logo');
        if (storedLogo) {
            const prev = document.getElementById('logo-preview');
            prev.src = storedLogo;
            prev.classList.remove('hidden');
            document.getElementById('logo-placeholder').classList.add('hidden');
        }

        document.getElementById('logo-upload').onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const data = ev.target.result;
                    localStorage.setItem('gaming_crm_logo', data);
                    const prev = document.getElementById('logo-preview');
                    prev.src = data;
                    prev.classList.remove('hidden');
                    document.getElementById('logo-placeholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        };

        window.onload = render;
    </script>
</body>
</html>
</html>

